{"version":3,"sources":["../src/managerules.js"],"names":["init","document","getElementById","addEventListener","editrule","evt","el","target","nodeName","parentElement","cls","getAttribute","includes","hiderule","deleterule","preventDefault","ruleid","dataset","action","stringsPromise","Str","get_strings","done","strings","Ajax","call","methodname","args","data","success","hide","innerHTML","show","ModalFactory","create","type","types","SAVE_CANCEL","body","get_string","title","removeOnClose","buttons","save","cancel","then","modal","getRoot","on","ModalEvents","row","parentNode","remove"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @file       UI scripts for Grade Calculation Setup Tool.\n * @copyright  Te Wānanga o Aotearoa\n * @author     Jeremy FitzPatrick\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Ajax from 'core/ajax';\nimport * as ModalFactory from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport * as Str from 'core/str';\n\nexport const init = () => {\n    document.getElementById('rulestable').addEventListener('click', editrule);\n};\n\n/**\n * Decide which edit button was pressed\n * @param {Event} evt\n */\nconst editrule = (evt) => {\n    let el = evt.target;\n    if (el.nodeName === \"I\") {\n        el = el.parentElement;\n    } else if (el.nodeName !== \"A\") {\n        return;\n    }\n    let cls = el.getAttribute('class');\n    if (cls.includes('showhide')) {\n        // Call showhide.\n        hiderule(el);\n    } else if (cls.includes('delete')) {\n        // Show confirm.\n        deleterule(el);\n    } else {\n        return;\n    }\n    evt.preventDefault();\n};\n\n/**\n * Handle UI request to hide a rule\n * @param {HTMLElement} el\n */\nconst hiderule = (el) => {\n    let ruleid = el.dataset.ruleid || 0;\n    let action = el.dataset.action;\n\n    var reqStrings = [\n        {'key': 'hide'},\n        {'key': 'show'},\n    ];\n    var stringsPromise = Str.get_strings(reqStrings);\n    stringsPromise.done(function(strings) {\n\n        Ajax.call([{\n            methodname: 'gradereport_calcsetup_hiderule',\n            args: {\n                'id': ruleid,\n                'action': action\n            },\n            done: function(data) {\n                if (data.success === false){\n                    return;\n                }\n                if (action == 1) {\n                    let hide = strings[0];\n                    el.innerHTML = \"<i class='icon fa fa-eye fa-fw' title='\" + hide + \"' aria-label='\" + hide + \"'></i>\";\n                    el.dataset.action = 0;\n                } else {\n                    let show = strings[1];\n                    el.innerHTML = \"<i class='icon fa fa-eye-slash fa-fw' title='\" + show + \"' aria-label='\" + show + \"'></i>\";\n                    el.dataset.action = 1;\n                }\n            }\n        }]);\n    });\n};\n\n/**\n * Handle UI request to delete a rule\n * @param {HTMLElement} el\n * @return {*}\n */\nconst deleterule = (el) => {\n    let ruleid = el.dataset.ruleid || 0;\n\n    return ModalFactory.create({\n        type: ModalFactory.types.SAVE_CANCEL,\n        body: Str.get_string('deleterulereally', 'gradereport_calcsetup'),\n        title: Str.get_string('deleterule', 'gradereport_calcsetup'),\n        removeOnClose: true,\n        buttons: {\n            save: Str.get_string('yes'),\n            cancel: Str.get_string('no'),\n        }\n    }).then(function(modal) {\n        modal.getRoot().on(ModalEvents.save, function() {\n            Ajax.call([{\n                methodname: 'gradereport_calcsetup_deleterule',\n                args: {\n                    'id': ruleid\n                },\n                done: function(data) {\n                    if (data.success === false){\n                        return false;\n                    }\n                    let row = el.parentNode.parentNode;\n                    row.remove();\n                    return true;\n                }\n            }]);\n        });\n\n        modal.show();\n        return true;\n    });\n};\n"],"file":"managerules.min.js"}