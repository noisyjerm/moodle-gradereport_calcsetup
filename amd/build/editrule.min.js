define ("gradereport_calcsetup/editrule",["exports","core/modal_factory","core/modal_events","core/str","core/templates","core/notification","core/ajax"],function(a,b,c,d,e,f,g){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=i(b);c=i(c);d=i(d);e=i(e);f=function(a){return a&&a.__esModule?a:{default:a}}(f);g=i(g);function h(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;h=function(){return a};return a}function i(a){if(a&&a.__esModule){return a}if(null===a||"object"!==j(a)&&"function"!=typeof a){return{default:a}}var b=h();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function j(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){j=function(a){return typeof a}}else{j=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return j(a)}a.init=function init(){document.querySelector(".rule-fields").parentElement.addEventListener("click",k);document.querySelector(".rule-cols").parentElement.addEventListener("click",k)};var k=function(a){var h=a.target;if("I"!==h.nodeName){return}a.preventDefault();var k=h.closest("div"),m=k.parentNode,n=parseInt(k.dataset.index),o=document.querySelector("input[name="+k.dataset.targetele+"]"),p=JSON.parse(o.value),q=h.dataset.action;if("up"===q){var s=p[n-1];p[n-1]=p[n];p[n]=s;k.dataset.index=n-1;k.previousSibling.dataset.index=n;m.insertBefore(k,k.previousSibling);o.value=JSON.stringify(p);return}if("down"===q){var t=p[n+1];p[n+1]=p[n];p[n]=t;k.dataset.index=n+1;k.nextSibling.dataset.index=n;m.insertBefore(k.nextSibling,k);o.value=JSON.stringify(p);return}if("delete"===q){p.splice(n,1);for(var r=n;r<m.children.length;r++){m.children[r].dataset.index=m.children[r].dataset.index-1}k.remove();o.value=JSON.stringify(p);return}if("edit"===q){return b.create({type:b.types.SAVE_CANCEL,body:"",title:d.get_string("editfield","gradereport_calcsetup"),removeOnClose:!0}).then(function(a){a.getRoot().on(c.save,function(){if("undefined"==typeof p[n]){p[n]={};var c=k.parentElement.appendChild(k.cloneNode(!0));c.dataset.index=n+1;k.querySelector("span:last-of-type").innerHTML="<a class='up' href='#'><i class='icon fa fa-arrow-up fa-fw ' title='$strup' aria-label='$strup' data-action='up'></i></a><a class='down' href='#'><i class='icon fa fa-arrow-down fa-fw ' title='$strdn' aria-label='$strdn' data-action='down'></i></a><a class='delete' href='#'><i class='icon fa fa-trash fa-fw ' title='$strdel' aria-label='$strdel' data-action='delete'></i></a><a class='edit' href='#'><i class='icon fa fa-cog fa-fw ' title='$stredit' aria-label='$stredit' data-action='edit'></i></a>"}var a=[{key:"editable",component:"gradereport_calcsetup"},{key:"locked",component:"gradereport_calcsetup"}];p[n].title=l(document.getElementById("coltitle").value);p[n].property=document.getElementById("colproperty").value;p[n].editable=document.getElementById("coleditable").checked;if("object"===j(p[n].title)){a.push({key:p[n].title.identifier,component:p[n].title.component})}var b=d.get_strings(a);b.done(function(a){k.querySelector("span:first-of-type").innerHTML="object"===j(p[n].title)?a[2]:p[n].title;k.querySelector("span:nth-of-type(2)").innerHTML=p[n].property;k.querySelector("span:nth-of-type(3)").innerHTML=p[n].editable?a[0]:a[1]});o.value=JSON.stringify(p)});a.getRoot().on(c.hidden,function(){a.destroy()});g.call([{methodname:"gradereport_calcsetup_get_corefields",args:{},done:function done(b){b.col=p[n];var c=d.get_string("free","gradereport_calcsetup");c.done(function(a){var c=b.fields.push({property:"free"});if("undefined"!=typeof b.col){b.exists=!0;for(var d=0;d<c;d++){if(b.fields[d].property==b.col.property){b.fields[d].selected=!0;break}}if(d===c){b.fields.push({property:b.col.property,selected:!0})}b.title="object"===j(p[n].title)?JSON.stringify(p[n].title):p[n].title}b.fields[c-1].property=a;b.fields[c-1].value="free";e.renderForPromise("gradereport_calcsetup/editfield",b).then(function(a){var b=a.html,c=a.js;e.appendNodeContents(".modal-body",b,c);document.getElementById("colproperty").addEventListener("change",function(a){if("free"===a.target.value){var b=document.createElement("input");b.setAttribute("id",a.target.getAttribute("id"));a.target.parentElement.insertBefore(b,a.target);a.target.remove()}});return!0}).catch(f.default.exception)});a.show()}}]);return!0})}},l=function(a){try{var b=JSON.parse(a);if(b&&"object"===j(b)){return b}}catch(a){}return a}});
//# sourceMappingURL=editrule.min.js.map
