define ("gradereport_calcsetup/editrule",["exports","core/modal_factory","core/modal_events","core/str","core/templates","core/notification","core/ajax"],function(a,b,c,d,e,f,g){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=i(b);c=i(c);d=i(d);e=i(e);f=function(a){return a&&a.__esModule?a:{default:a}}(f);g=i(g);function h(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;h=function(){return a};return a}function i(a){if(a&&a.__esModule){return a}if(null===a||"object"!==j(a)&&"function"!=typeof a){return{default:a}}var b=h();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function j(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){j=function(a){return typeof a}}else{j=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return j(a)}a.init=function init(){document.querySelector(".rule-field").parentElement.addEventListener("click",k)};var k=function(a){var h=a.target;if("I"!==h.nodeName){return}a.preventDefault();var k=JSON.parse(document.querySelector("input[name=cols]").value),m=h.dataset.action,n=h.closest("div"),o=n.parentNode,p=parseInt(n.dataset.index);if("up"===m){var r=k[p-1];k[p-1]=k[p];k[p]=r;n.dataset.index=p-1;n.previousSibling.dataset.index=p;o.insertBefore(n,n.previousSibling);document.querySelector("input[name=cols]").value=JSON.stringify(k);return}if("down"===m){var s=k[p+1];k[p+1]=k[p];k[p]=s;n.dataset.index=p+1;n.nextSibling.dataset.index=p;o.insertBefore(n.nextSibling,n);document.querySelector("input[name=cols]").value=JSON.stringify(k);return}if("delete"===m){k.splice(p,1);for(var q=p;q<o.children.length;q++){o.children[q].dataset.index=o.children[q].dataset.index-1}n.remove();document.querySelector("input[name=cols]").value=JSON.stringify(k);return}if("edit"===m){return b.create({type:b.types.SAVE_CANCEL,body:"",title:d.get_string("deleterule","gradereport_calcsetup"),removeOnClose:!0,buttons:{save:d.get_string("yes"),cancel:d.get_string("no")}}).then(function(a){a.getRoot().on(c.save,function(){if("undefined"==typeof k[p]){k[p]={};var c=n.parentElement.appendChild(n.cloneNode(!0));c.dataset.index=p+1;n.querySelector("span:last-of-type").innerHTML="<a class='up' href='#'><i class='icon fa fa-arrow-up fa-fw ' title='$strup' aria-label='$strup' data-action='up'></i></a><a class='down' href='#'><i class='icon fa fa-arrow-down fa-fw ' title='$strdn' aria-label='$strdn' data-action='down'></i></a><a class='delete' href='#'><i class='icon fa fa-trash fa-fw ' title='$strdel' aria-label='$strdel' data-action='delete'></i></a><a class='edit' href='#'><i class='icon fa fa-cog fa-fw ' title='$stredit' aria-label='$stredit' data-action='edit'></i></a>"}var a=[{key:"editable",component:"gradereport_calcsetup"},{key:"locked",component:"gradereport_calcsetup"}];k[p].title=l(document.getElementById("coltitle").value);k[p].property=document.getElementById("colproperty").value;k[p].editable=document.getElementById("coleditable").checked;if("object"===j(k[p].title)){a.push({key:k[p].title.identifier,component:k[p].title.component})}var b=d.get_strings(a);b.done(function(a){n.querySelector("span:first-of-type").innerHTML="object"===j(k[p].title)?a[2]:k[p].title;n.querySelector("span:nth-of-type(2)").innerHTML=k[p].property;n.querySelector("span:nth-of-type(3)").innerHTML=k[p].editable?a[0]:a[1]});document.querySelector("input[name=cols]").value=JSON.stringify(k)});g.call([{methodname:"gradereport_calcsetup_get_corefields",args:{},done:function done(b){b.col=k[p];if("undefined"!=typeof b.col){for(var c=0;c<b.fields.length;c++){if(b.fields[c].property==b.col.property){b.fields[c].selected=!0}}b.title="object"===j(k[p].title)?JSON.stringify(k[p].title):k[p].title}e.renderForPromise("gradereport_calcsetup/editfield",b).then(function(a){var b=a.html,c=a.js;e.appendNodeContents(".modal-body",b,c);return!0}).catch(f.default.exception);a.show()}}]);return!0})}},l=function(a){try{var b=JSON.parse(a);if(b&&"object"===j(b)){return b}}catch(a){}return a}});
//# sourceMappingURL=editrule.min.js.map
