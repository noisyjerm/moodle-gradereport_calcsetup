{"version":3,"file":"editrule.min.js","sources":["../src/editrule.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @file       UI scripts for Grade Calculation Setup Tool.\n * @copyright  Te Wānanga o Aotearoa\n * @author     Jeremy FitzPatrick\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as ModalFactory from \"core/modal_factory\";\nimport * as ModalEvents from \"core/modal_events\";\nimport * as Str from \"core/str\";\nimport * as Templates from \"core/templates\";\nimport Notification from \"core/notification\";\nimport * as Ajax from \"core/ajax\";\n\nexport const init = () => {\n    document.querySelector(\".rule-fields\").parentElement.addEventListener(\"click\", editrule);\n    document.querySelector(\".rule-cols\").parentElement.addEventListener(\"click\", editrule);\n    document.querySelector(\".rule-actions\").parentElement.addEventListener(\"click\", editaction);\n    document.querySelector('.loophelper').addEventListener('click', loopHelper);\n};\n\n/**\n * Perform action on Fields or Columns\n * reorder up, reorder down, delete, edit.\n * @param {Event} evt\n * @return {boolean}\n */\nconst editrule = (evt) => {\n    let el = evt.target;\n\n    if (el.nodeName !== \"I\") {\n        return;\n    }\n    evt.preventDefault();\n\n    let row = el.closest(\"div\");\n    let container = row.parentNode;\n    let index = parseInt(row.dataset.index);\n    var field = document.querySelector(\"input[name=\" + row.dataset.targetele + \"]\");\n    let columns = JSON.parse(field.value);\n    let action = el.dataset.action;\n\n    if (action === \"up\") {\n        let oldfield = columns[index - 1];\n        columns[index - 1] = columns[index];\n        columns[index] = oldfield;\n\n        row.dataset.index = index - 1;\n        row.previousSibling.dataset.index = index;\n        container.insertBefore(row, row.previousSibling);\n\n        field.value = JSON.stringify(columns);\n        return true;\n    }\n\n    if (action === \"down\") {\n        let oldfield = columns[index + 1];\n        columns[index + 1] = columns[index];\n        columns[index] = oldfield;\n\n        row.dataset.index = index + 1;\n        row.nextSibling.dataset.index = index;\n        container.insertBefore(row.nextSibling, row);\n\n        field.value = JSON.stringify(columns);\n        return true;\n    }\n\n    if (action === \"delete\") {\n        columns.splice(index, 1);\n        for (let i = index; i < container.children.length; i++) {\n            container.children[i].dataset.index = container.children[i].dataset.index - 1;\n        }\n        row.remove();\n        field.value = JSON.stringify(columns);\n        return true;\n    }\n\n    if (action === \"edit\") {\n        let title = row.dataset.targetele === 'fields'\n                   ? Str.get_string(\"editfield\", \"gradereport_calcsetup\")\n                   : Str.get_string(\"editcols\", \"gradereport_calcsetup\");\n\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            body: \"\",\n            title: title,\n            removeOnClose: true\n        }).then(function(modal) {\n            modal.getRoot().on('change', swapSelect);\n            modal.getRoot().on(ModalEvents.save, {columns: columns, row: row, index: index, field: field}, saveFields);\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n            });\n            Ajax.call([{\n                methodname: \"gradereport_calcsetup_get_corefields\",\n                args: {\n                    'editableonly': false\n                },\n                done: function(data) {\n                    data.col = columns[index];\n                    let stringsPromise = Str.get_string(\"free\", \"gradereport_calcsetup\");\n                    stringsPromise.done(function(string) {\n                        data.exists = index < columns.length;\n                        let prop = data.exists ? data.col.property : null;\n                        data.fields = getCorefields(data.fields, prop, string);\n                        if (typeof data.col !== 'undefined') {\n                            if (typeof columns[index].title === \"object\") {\n                                data.title = columns[index].title.identifier;\n                                data.component = columns[index].title.component;\n                            } else {\n                                data.title = columns[index].title;\n                            }\n                        }\n                        Templates.renderForPromise(\"gradereport_calcsetup/editfield\", data)\n                            .then(({html, js}) => {\n                                Templates.appendNodeContents(\".modal-body\", html, js);\n                                return true;\n                            })\n                            .catch(Notification.exception);\n                    });\n                    modal.show();\n                }\n            }]);\n\n            return true;\n        }).catch(Notification.exception);\n    }\n    return false;\n};\n\n/**\n * Perform acitons on actions:\n * delete or edit.\n * @param {event} evt\n */\nconst editaction = (evt) => {\n    let el = evt.target;\n\n    if (el.nodeName !== \"I\") {\n        return;\n    }\n    evt.preventDefault();\n\n    let row = el.closest(\"div\");\n    let container = row.parentNode;\n    let index = parseInt(row.dataset.index);\n    var field = document.querySelector(\"input[name=actions]\");\n    let actions = JSON.parse(field.value);\n    let action = el.dataset.action;\n\n    if (action === \"up\") {\n        let oldfield = actions[index - 1];\n        actions[index - 1] = actions[index];\n        actions[index] = oldfield;\n\n        row.dataset.index = index - 1;\n        row.previousSibling.dataset.index = index;\n        container.insertBefore(row, row.previousSibling);\n\n        field.value = JSON.stringify(actions);\n        return;\n    }\n\n    if (action === \"down\") {\n        let oldfield = actions[index + 1];\n        actions[index + 1] = actions[index];\n        actions[index] = oldfield;\n\n        row.dataset.index = index + 1;\n        row.nextSibling.dataset.index = index;\n        container.insertBefore(row.nextSibling, row);\n\n        field.value = JSON.stringify(actions);\n        return;\n    }\n\n    if (action === 'edit') {\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            body: \"\",\n            title: Str.get_string(\"editaction\", \"gradereport_calcsetup\"),\n            removeOnClose: true\n        }).then(function(modal) {\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n            });\n            modal.getRoot().on('change', swapSelect);\n            modal.getRoot().on(ModalEvents.save, function() {\n                if (index === actions.length) {\n                    actions.push({'op': 'equals'});\n                    let addrow = row.parentElement.appendChild(row.cloneNode(true));\n                    addrow.dataset.index = index + 1;\n                    row.querySelector('span:last-of-type').innerHTML = \"<a class='up' href='#'>\" +\n                        \"<i class='icon fa fa-arrow-up fa-fw ' title='$strup' aria-label='$strup' data-action='up'></i>\" +\n                        \"</a><a class='down' href='#'>\" +\n                        \"<i class='icon fa fa-arrow-down fa-fw ' title='$strdn' aria-label='$strdn' data-action='down'></i>\" +\n                        '</a><a href=\"#\">' +\n                        '<i class=\"icon fa fa-trash fa-fw\" title=\"Delete\" aria-label=\"Delete\" data-action=\"delete\"></i></a>' +\n                        '<a href=\"#\" ><i class=\"icon fa fa-cog fa-fw\" title=\"Edit\" aria-label=\"Edit\" data-action=\"edit\"></i></a>';\n                }\n\n                actions[index].set = document.getElementById(\"actionset\").value;\n                actions[index].to = document.getElementById(\"actionto\").value;\n                actions[index].when = document.getElementById(\"actionwhen\").value;\n                actions[index].op = \"equals\";\n                actions[index].val = document.getElementById(\"actionval\").value;\n                field.value = JSON.stringify(actions);\n\n                // First get operator string\n                let operator = Str.get_string(actions[index].op, 'gradereport_calcsetup', actions[index]);\n                let astring = 'action';\n                if (actions[index].val === \"\") {\n                    astring = 'actionall';\n                }\n                operator.done(function(string) {\n                    actions[index].op = string;\n                    let description = Str.get_string(astring, 'gradereport_calcsetup', actions[index]);\n                    description.done(function(string) {\n                        row.querySelector('span:first-of-type').innerHTML = string;\n                    });\n                });\n\n            });\n            Ajax.call([{\n                methodname: \"gradereport_calcsetup_get_corefields\",\n                args: {\n                    'editableonly': false\n                },\n                done: function(data) {\n                    let stringsPromise = Str.get_string(\"free\", \"gradereport_calcsetup\");\n                    stringsPromise.done(function(string) {\n                        let actionrow = {};\n                        actionrow.action = index < actions.length ? actions[index] : [];\n                        actionrow.exists = index < actions.length;\n                        actionrow.fields = getCorefields(data.fields, actionrow.exists ? actions[index].set : null, string);\n                        actionrow.fieldswhen = getCorefields(data.fields, actionrow.exists ? actions[index].when : null, string);\n                        Templates.renderForPromise(\"gradereport_calcsetup/editaction\", actionrow)\n                            .then(({html, js}) => {\n                                Templates.appendNodeContents(\".modal-body\", html, js);\n                                return true;\n                            })\n                            .catch(Notification.exception);\n                    });\n\n                    modal.show();\n                }\n            }]);\n            return true;\n        }).catch(Notification.exception);\n\n    }\n\n    if (action === 'delete') {\n        actions.splice(index, 1);\n        for (var i = index; i < container.children.length; i++) {\n            container.children[i].dataset.index = container.children[i].dataset.index - 1;\n        }\n        row.remove();\n        field.value = JSON.stringify(actions);\n    }\n};\n\n/**\n * Replace Select element with Input on Change event when value is \"free\"\n * @param {event} e\n */\nconst swapSelect = (e) => {\n    if (e.target.getAttribute(\"id\") === \"actionwhen\") {\n        let valInput = document.getElementById(\"actionval\");\n        if (e.target.value !== \"all\") {\n            valInput.removeAttribute('disabled');\n        } else {\n            valInput.setAttribute('disabled', 'disabled');\n        }\n    }\n    if (e.target.value === \"free\") {\n        let input = document.createElement(\"input\");\n        input.setAttribute(\"id\", e.target.getAttribute(\"id\"));\n        e.target.parentElement.insertBefore(input, e.target);\n        e.target.remove();\n    }\n};\n\n/**\n * Store Fields or Columns info in appropriate hidden form field as JSON string\n * and update UI when dialog \"save\" button is clicked.\n * @param {event} e\n */\nconst saveFields = (e) => {\n    let columns = e.data.columns;\n    let row = e.data.row;\n    let index = e.data.index;\n    let field = e.data.field;\n\n    if (typeof columns[index] === 'undefined') {\n        columns[index] = {};\n        let addrow = row.parentElement.appendChild(row.cloneNode(true));\n        addrow.dataset.index = index + 1;\n        row.querySelector(\"span:last-of-type\").innerHTML =\n            \"<a class='up' href='#'>\" +\n            \"<i class='icon fa fa-arrow-up fa-fw ' title='$strup' aria-label='$strup' data-action='up'></i>\" +\n            \"</a><a class='down' href='#'>\" +\n            \"<i class='icon fa fa-arrow-down fa-fw ' title='$strdn' aria-label='$strdn' data-action='down'></i>\" +\n            \"</a><a class='delete' href='#'>\" +\n            \"<i class='icon fa fa-trash fa-fw ' title='$strdel' aria-label='$strdel' data-action='delete'></i>\" +\n            \"</a><a class='edit' href='#'>\" +\n            \"<i class='icon fa fa-cog fa-fw ' title='$stredit' aria-label='$stredit' data-action='edit'></i></a>\";\n    }\n    let reqStrings = [\n        {\"key\": \"editable\", \"component\": \"gradereport_calcsetup\"},\n        {\"key\": \"locked\", \"component\": \"gradereport_calcsetup\"}\n    ];\n\n    // Set the data.\n    let title = document.getElementById(\"coltitle\").value;\n    let component = document.getElementById(\"titlecomp\").value;\n    columns[index].title = {\"identifier\": title, \"component\": component};\n    columns[index].property = document.getElementById(\"colproperty\").value;\n    columns[index].editable = document.getElementById(\"coleditable\").checked;\n    // Set the dom.\n    reqStrings.push({\n        \"key\": columns[index].title.identifier,\n        \"component\": columns[index].title.component\n    });\n\n    let stringsPromise = Str.get_strings(reqStrings);\n    stringsPromise.done(function(strings) {\n        let re = /^\\[\\[.+\\]\\]$/;\n        if (re.test(strings[2])) {\n            columns[index].title = title;\n            row.querySelector(\"span:first-of-type\").innerHTML = title;\n        } else {\n            row.querySelector(\"span:first-of-type\").innerHTML = strings[2];\n        }\n\n        row.querySelector(\"span:nth-of-type(2)\").innerHTML = columns[index].property;\n        row.querySelector(\"span:nth-of-type(3)\").innerHTML = columns[index].editable\n            ? strings[0]\n            : strings[1];\n        field.value = JSON.stringify(columns);\n    });\n\n};\n\n/**\n * Prepare a list of core fields for select elements\n * @param {array} data array of objects\n * @param {string|null} property name of selected property\n * @param {string} string lang string for 'free form' option\n * @return {any}\n */\nconst getCorefields = (data, property, string) => {\n    // We need a deep clone.\n    let dataString = JSON.stringify(data);\n    let giProperties = JSON.parse(dataString);\n    let l = giProperties.push({\"property\": \"free\"});\n    if (typeof property == 'string') {\n        var i;\n        for (i = 0; i < l; i++) {\n            if (giProperties[i].property === property) {\n                giProperties[i].selected = true;\n                break;\n            }\n        }\n        if (i === l) {\n            giProperties.push({\"property\": property, \"selected\": true});\n        }\n    }\n\n    // Replace the last item \"free\" with a readable name.\n    giProperties[l - 1].property = string;\n    giProperties[l - 1].value = \"free\";\n    return giProperties;\n};\n\n/**\n * Show tool (dialog) to construct a loop portion of the calculation formula template.\n * @param {event} evt\n * @return {boolean}\n */\nconst loopHelper = (evt) => {\n    evt.preventDefault();\n    return ModalFactory.create({\n        type: ModalFactory.types.DEFAULT,\n        body: \"\",\n        title: Str.get_string('loophelper', 'gradereport_calcsetup'),\n        removeOnClose: false\n    }).then(function(modal) {\n        modal.getRoot().on('change', updateCalc);\n        Ajax.call([{\n            methodname: \"gradereport_calcsetup_get_corefields\",\n            args: {\n                'editableonly': false\n            },\n            done: function(data) {\n                Templates.renderForPromise(\"gradereport_calcsetup/looper\", data)\n                    .then(({html, js}) => {\n                        Templates.appendNodeContents(\".modal-body\", html, js);\n                        let copyBtn = modal.getRoot()[0].querySelector('.copyme');\n                        if (navigator.clipboard) {\n                            copyBtn.addEventListener('click', function(e) {\n                                let copyText = e.target.previousElementSibling;\n                                copyText.select();\n                                copyText.setSelectionRange(0, 99999);\n                                navigator.clipboard.writeText(copyText.value);\n                            });\n                        } else {\n                            copyBtn.setAttribute(\"style\", \"display:none\");\n                        }\n                        return true;\n                    })\n                    .catch(Notification.exception);\n            }}]);\n        modal.show();\n        return true;\n    });\n};\n\n/**\n * Displays the template loop string as inputs in loopHelper dialog change.\n * @param {event} evt\n * @return {boolean}\n */\nconst updateCalc = (evt) => {\n    let container = evt.target.closest('.modal-body');\n    let group = container.querySelector('#loopgroup').value;\n    let contentInput = container.querySelector('#loopcontent');\n    let separator = container.querySelector('#loopseparator').value;\n\n    if (evt.target.getAttribute('id') === 'loopproperty') {\n        contentInput.value = contentInput.value + \"{{\" + evt.target.value + \"}}\";\n    }\n\n    if (evt.target.getAttribute('id') === '') {\n        return true;\n    } else {\n        container.querySelector('.output').value =\n            \"{{#\" + group + \"}}\" + contentInput.value + \"{{^last}}\" + separator + \"{{/last}}{{/\" + group + \"}}\";\n    }\n\n    return true;\n};"],"names":["document","querySelector","parentElement","addEventListener","editrule","editaction","loopHelper","evt","el","target","nodeName","preventDefault","row","closest","container","parentNode","index","parseInt","dataset","field","targetele","columns","JSON","parse","value","action","oldfield","previousSibling","insertBefore","stringify","nextSibling","splice","i","children","length","remove","title","Str","get_string","ModalFactory","create","type","types","SAVE_CANCEL","body","removeOnClose","then","modal","getRoot","on","swapSelect","ModalEvents","save","saveFields","hidden","destroy","Ajax","call","methodname","args","done","data","col","string","exists","prop","property","fields","getCorefields","_typeof","identifier","component","Templates","renderForPromise","html","js","appendNodeContents","catch","Notification","exception","show","actions","push","appendChild","cloneNode","innerHTML","set","getElementById","to","when","op","val","operator","astring","actionrow","fieldswhen","e","getAttribute","valInput","removeAttribute","setAttribute","input","createElement","reqStrings","editable","checked","get_strings","strings","test","dataString","giProperties","l","selected","DEFAULT","updateCalc","copyBtn","navigator","clipboard","copyText","previousElementSibling","select","setSelectionRange","writeText","group","contentInput","separator"],"mappings":"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"}