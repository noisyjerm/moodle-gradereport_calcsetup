{"version":3,"sources":["../src/editrule.js"],"names":["init","document","querySelector","parentElement","addEventListener","editrule","editaction","loopHelper","evt","el","target","nodeName","preventDefault","row","closest","container","parentNode","index","parseInt","dataset","field","targetele","columns","JSON","parse","value","action","oldfield","previousSibling","insertBefore","stringify","nextSibling","splice","i","children","length","remove","title","Str","get_string","ModalFactory","create","type","types","SAVE_CANCEL","body","removeOnClose","then","modal","getRoot","on","swapSelect","ModalEvents","save","saveFields","hidden","destroy","Ajax","call","methodname","args","done","data","col","stringsPromise","string","exists","prop","property","fields","getCorefields","Templates","renderForPromise","html","js","appendNodeContents","catch","Notification","exception","show","actions","push","addrow","appendChild","cloneNode","innerHTML","set","getElementById","to","when","val","operator","op","description","actionrow","fieldswhen","e","input","createElement","setAttribute","getAttribute","reqStrings","tryParseJSONObject","editable","checked","identifier","component","get_strings","strings","jsonString","o","dataString","giProperties","l","selected","DEFAULT","updateCalc","copyBtn","navigator","clipboard","copyText","previousElementSibling","select","setSelectionRange","writeText","group","contentInput","separator"],"mappings":"8PAsBA,OACA,OACA,OACA,OACA,uDACA,O,kzBAEoB,QAAPA,CAAAA,IAAO,EAAM,CACtBC,QAAQ,CAACC,aAAT,CAAuB,cAAvB,EAAuCC,aAAvC,CAAqDC,gBAArD,CAAsE,OAAtE,CAA+EC,CAA/E,EACAJ,QAAQ,CAACC,aAAT,CAAuB,YAAvB,EAAqCC,aAArC,CAAmDC,gBAAnD,CAAoE,OAApE,CAA6EC,CAA7E,EACAJ,QAAQ,CAACC,aAAT,CAAuB,eAAvB,EAAwCC,aAAxC,CAAsDC,gBAAtD,CAAuE,OAAvE,CAAgFE,CAAhF,EACAL,QAAQ,CAACC,aAAT,CAAuB,aAAvB,EAAsCE,gBAAtC,CAAuD,OAAvD,CAAgEG,CAAhE,CACH,C,IAMKF,CAAAA,CAAQ,CAAG,SAACG,CAAD,CAAS,CACtB,GAAIC,CAAAA,CAAE,CAAGD,CAAG,CAACE,MAAb,CAEA,GAAoB,GAAhB,GAAAD,CAAE,CAACE,QAAP,CAAyB,CACrB,MACH,CACDH,CAAG,CAACI,cAAJ,GANsB,GAQlBC,CAAAA,CAAG,CAAGJ,CAAE,CAACK,OAAH,CAAW,KAAX,CARY,CASlBC,CAAS,CAAGF,CAAG,CAACG,UATE,CAUlBC,CAAK,CAAGC,QAAQ,CAACL,CAAG,CAACM,OAAJ,CAAYF,KAAb,CAVE,CAWlBG,CAAK,CAAGnB,QAAQ,CAACC,aAAT,CAAuB,cAAgBW,CAAG,CAACM,OAAJ,CAAYE,SAA5B,CAAwC,GAA/D,CAXU,CAYlBC,CAAO,CAAGC,IAAI,CAACC,KAAL,CAAWJ,CAAK,CAACK,KAAjB,CAZQ,CAalBC,CAAM,CAAGjB,CAAE,CAACU,OAAH,CAAWO,MAbF,CAetB,GAAe,IAAX,GAAAA,CAAJ,CAAqB,CACjB,GAAIC,CAAAA,CAAQ,CAAGL,CAAO,CAACL,CAAK,CAAG,CAAT,CAAtB,CACAK,CAAO,CAACL,CAAK,CAAG,CAAT,CAAP,CAAqBK,CAAO,CAACL,CAAD,CAA5B,CACAK,CAAO,CAACL,CAAD,CAAP,CAAiBU,CAAjB,CAEAd,CAAG,CAACM,OAAJ,CAAYF,KAAZ,CAAoBA,CAAK,CAAG,CAA5B,CACAJ,CAAG,CAACe,eAAJ,CAAoBT,OAApB,CAA4BF,KAA5B,CAAoCA,CAApC,CACAF,CAAS,CAACc,YAAV,CAAuBhB,CAAvB,CAA4BA,CAAG,CAACe,eAAhC,EAEAR,CAAK,CAACK,KAAN,CAAcF,IAAI,CAACO,SAAL,CAAeR,CAAf,CAAd,CACA,MACH,CAED,GAAe,MAAX,GAAAI,CAAJ,CAAuB,CACnB,GAAIC,CAAAA,CAAQ,CAAGL,CAAO,CAACL,CAAK,CAAG,CAAT,CAAtB,CACAK,CAAO,CAACL,CAAK,CAAG,CAAT,CAAP,CAAqBK,CAAO,CAACL,CAAD,CAA5B,CACAK,CAAO,CAACL,CAAD,CAAP,CAAiBU,CAAjB,CAEAd,CAAG,CAACM,OAAJ,CAAYF,KAAZ,CAAoBA,CAAK,CAAG,CAA5B,CACAJ,CAAG,CAACkB,WAAJ,CAAgBZ,OAAhB,CAAwBF,KAAxB,CAAgCA,CAAhC,CACAF,CAAS,CAACc,YAAV,CAAuBhB,CAAG,CAACkB,WAA3B,CAAwClB,CAAxC,EAEAO,CAAK,CAACK,KAAN,CAAcF,IAAI,CAACO,SAAL,CAAeR,CAAf,CAAd,CACA,MACH,CAED,GAAe,QAAX,GAAAI,CAAJ,CAAyB,CACrBJ,CAAO,CAACU,MAAR,CAAef,CAAf,CAAsB,CAAtB,EACA,IAAK,GAAIgB,CAAAA,CAAC,CAAGhB,CAAb,CAAoBgB,CAAC,CAAGlB,CAAS,CAACmB,QAAV,CAAmBC,MAA3C,CAAmDF,CAAC,EAApD,CAAwD,CACpDlB,CAAS,CAACmB,QAAV,CAAmBD,CAAnB,EAAsBd,OAAtB,CAA8BF,KAA9B,CAAsCF,CAAS,CAACmB,QAAV,CAAmBD,CAAnB,EAAsBd,OAAtB,CAA8BF,KAA9B,CAAsC,CAC/E,CACDJ,CAAG,CAACuB,MAAJ,GACAhB,CAAK,CAACK,KAAN,CAAcF,IAAI,CAACO,SAAL,CAAeR,CAAf,CAAd,CACA,MACH,CAED,GAAe,MAAX,GAAAI,CAAJ,CAAuB,CACnB,GAAIW,CAAAA,CAAK,CAA6B,QAA1B,GAAAxB,CAAG,CAACM,OAAJ,CAAYE,SAAZ,CACCiB,CAAG,CAACC,UAAJ,CAAe,WAAf,CAA4B,uBAA5B,CADD,CAECD,CAAG,CAACC,UAAJ,CAAe,UAAf,CAA2B,uBAA3B,CAFb,CAIAC,CAAY,CAACC,MAAb,CAAoB,CAChBC,IAAI,CAAEF,CAAY,CAACG,KAAb,CAAmBC,WADT,CAEhBC,IAAI,CAAE,EAFU,CAGhBR,KAAK,CAAEA,CAHS,CAIhBS,aAAa,GAJG,CAApB,EAKGC,IALH,CAKQ,SAASC,CAAT,CAAgB,CACpBA,CAAK,CAACC,OAAN,GAAgBC,EAAhB,CAAmB,QAAnB,CAA6BC,CAA7B,EACAH,CAAK,CAACC,OAAN,GAAgBC,EAAhB,CAAmBE,CAAW,CAACC,IAA/B,CAAqC,CAAC/B,OAAO,CAAEA,CAAV,CAAmBT,GAAG,CAAEA,CAAxB,CAA6BI,KAAK,CAAEA,CAApC,CAA2CG,KAAK,CAAEA,CAAlD,CAArC,CAA+FkC,CAA/F,EACAN,CAAK,CAACC,OAAN,GAAgBC,EAAhB,CAAmBE,CAAW,CAACG,MAA/B,CAAuC,UAAW,CAC9CP,CAAK,CAACQ,OAAN,EACH,CAFD,EAGAC,CAAI,CAACC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,sCADL,CAEPC,IAAI,CAAE,CACF,eADE,CAFC,CAKPC,IAAI,CAAE,cAASC,CAAT,CAAe,CACjBA,CAAI,CAACC,GAAL,CAAWzC,CAAO,CAACL,CAAD,CAAlB,CACA,GAAI+C,CAAAA,CAAc,CAAG1B,CAAG,CAACC,UAAJ,CAAe,MAAf,CAAuB,uBAAvB,CAArB,CACAyB,CAAc,CAACH,IAAf,CAAoB,SAASI,CAAT,CAAiB,CACjCH,CAAI,CAACI,MAAL,CAAcjD,CAAK,CAAGK,CAAO,CAACa,MAA9B,CACA,GAAIgC,CAAAA,CAAI,CAAGL,CAAI,CAACI,MAAL,CAAcJ,CAAI,CAACC,GAAL,CAASK,QAAvB,CAAkC,IAA7C,CACAN,CAAI,CAACO,MAAL,CAAcC,CAAa,CAACR,CAAI,CAACO,MAAN,CAAcF,CAAd,CAAoBF,CAApB,CAA3B,CACA,GAAwB,WAApB,QAAOH,CAAAA,CAAI,CAACC,GAAhB,CAAqC,CACjCD,CAAI,CAACzB,KAAL,CAA6C,QAAhC,KAAOf,CAAO,CAACL,CAAD,CAAP,CAAeoB,KAAtB,EACPd,IAAI,CAACO,SAAL,CAAeR,CAAO,CAACL,CAAD,CAAP,CAAeoB,KAA9B,CADO,CAEPf,CAAO,CAACL,CAAD,CAAP,CAAeoB,KACxB,CACDkC,CAAS,CAACC,gBAAV,CAA2B,iCAA3B,CAA8DV,CAA9D,EACKf,IADL,CACU,WAAgB,IAAd0B,CAAAA,CAAc,GAAdA,IAAc,CAARC,CAAQ,GAARA,EAAQ,CAClBH,CAAS,CAACI,kBAAV,CAA6B,aAA7B,CAA4CF,CAA5C,CAAkDC,CAAlD,EACA,QACH,CAJL,EAKKE,KALL,CAKWC,UAAaC,SALxB,CAMH,CAfD,EAgBA9B,CAAK,CAAC+B,IAAN,EACH,CAzBM,CAAD,CAAV,EA4BA,QACH,CAxCD,CAyCH,CACJ,C,CAEKzE,CAAU,CAAG,SAACE,CAAD,CAAS,CACxB,GAAIC,CAAAA,CAAE,CAAGD,CAAG,CAACE,MAAb,CAEA,GAAoB,GAAhB,GAAAD,CAAE,CAACE,QAAP,CAAyB,CACrB,MACH,CACDH,CAAG,CAACI,cAAJ,GANwB,GAQpBC,CAAAA,CAAG,CAAGJ,CAAE,CAACK,OAAH,CAAW,KAAX,CARc,CASpBC,CAAS,CAAGF,CAAG,CAACG,UATI,CAUpBC,CAAK,CAAGC,QAAQ,CAACL,CAAG,CAACM,OAAJ,CAAYF,KAAb,CAVI,CAWpBG,CAAK,CAAGnB,QAAQ,CAACC,aAAT,CAAuB,qBAAvB,CAXY,CAYpB8E,CAAO,CAAGzD,IAAI,CAACC,KAAL,CAAWJ,CAAK,CAACK,KAAjB,CAZU,CAapBC,CAAM,CAAGjB,CAAE,CAACU,OAAH,CAAWO,MAbA,CAexB,GAAe,MAAX,GAAAA,CAAJ,CAAuB,CACnBc,CAAY,CAACC,MAAb,CAAoB,CAChBC,IAAI,CAAEF,CAAY,CAACG,KAAb,CAAmBC,WADT,CAEhBC,IAAI,CAAE,EAFU,CAGhBR,KAAK,CAAEC,CAAG,CAACC,UAAJ,CAAe,YAAf,CAA6B,uBAA7B,CAHS,CAIhBO,aAAa,GAJG,CAApB,EAKGC,IALH,CAKQ,SAASC,CAAT,CAAgB,CACpBA,CAAK,CAACC,OAAN,GAAgBC,EAAhB,CAAmB,QAAnB,CAA6BC,CAA7B,EACAH,CAAK,CAACC,OAAN,GAAgBC,EAAhB,CAAmBE,CAAW,CAACC,IAA/B,CAAqC,UAAW,CAC5C,GAAIpC,CAAK,GAAK+D,CAAO,CAAC7C,MAAtB,CAA8B,CAC1B6C,CAAO,CAACC,IAAR,CAAa,CAAC,GAAM,QAAP,CAAb,EACA,GAAIC,CAAAA,CAAM,CAAGrE,CAAG,CAACV,aAAJ,CAAkBgF,WAAlB,CAA8BtE,CAAG,CAACuE,SAAJ,IAA9B,CAAb,CACAF,CAAM,CAAC/D,OAAP,CAAeF,KAAf,CAAuBA,CAAK,CAAG,CAA/B,CACAJ,CAAG,CAACX,aAAJ,CAAkB,mBAAlB,EAAuCmF,SAAvC,4OAGH,CAEDL,CAAO,CAAC/D,CAAD,CAAP,CAAeqE,GAAf,CAAqBrF,QAAQ,CAACsF,cAAT,CAAwB,WAAxB,EAAqC9D,KAA1D,CACAuD,CAAO,CAAC/D,CAAD,CAAP,CAAeuE,EAAf,CAAoBvF,QAAQ,CAACsF,cAAT,CAAwB,UAAxB,EAAoC9D,KAAxD,CACAuD,CAAO,CAAC/D,CAAD,CAAP,CAAewE,IAAf,CAAsBxF,QAAQ,CAACsF,cAAT,CAAwB,YAAxB,EAAsC9D,KAA5D,CACAuD,CAAO,CAAC/D,CAAD,CAAP,CAAeyE,GAAf,CAAqBzF,QAAQ,CAACsF,cAAT,CAAwB,WAAxB,EAAqC9D,KAA1D,CACAL,CAAK,CAACK,KAAN,CAAcF,IAAI,CAACO,SAAL,CAAekD,CAAf,CAAd,CAGA,GAAIW,CAAAA,CAAQ,CAAGrD,CAAG,CAACC,UAAJ,CAAeyC,CAAO,CAAC/D,CAAD,CAAP,CAAe2E,EAA9B,CAAkC,uBAAlC,CAA2DZ,CAAO,CAAC/D,CAAD,CAAlE,CAAf,CACA0E,CAAQ,CAAC9B,IAAT,CAAc,SAASI,CAAT,CAAiB,CAC3Be,CAAO,CAAC/D,CAAD,CAAP,CAAe2E,EAAf,CAAoB3B,CAApB,CACA,GAAI4B,CAAAA,CAAW,CAAGvD,CAAG,CAACC,UAAJ,CAAe,QAAf,CAAyB,uBAAzB,CAAkDyC,CAAO,CAAC/D,CAAD,CAAzD,CAAlB,CACA4E,CAAW,CAAChC,IAAZ,CAAiB,SAASI,CAAT,CAAiB,CAC9BpD,CAAG,CAACX,aAAJ,CAAkB,oBAAlB,EAAwCmF,SAAxC,CAAoDpB,CACvD,CAFD,CAGH,CAND,CAQH,CA1BD,EA2BAR,CAAI,CAACC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,sCADL,CAEPC,IAAI,CAAE,CACF,eADE,CAFC,CAKPC,IAAI,CAAE,cAASC,CAAT,CAAe,CACjB,GAAIE,CAAAA,CAAc,CAAG1B,CAAG,CAACC,UAAJ,CAAe,MAAf,CAAuB,uBAAvB,CAArB,CACAyB,CAAc,CAACH,IAAf,CAAoB,SAASI,CAAT,CAAiB,CACjC,GAAI6B,CAAAA,CAAS,CAAG,CACNpE,MADM,CACGT,CAAK,CAAG+D,CAAO,CAAC7C,MAAhB,CAAyB6C,CAAO,CAAC/D,CAAD,CAAhC,CAA0C,EAD7C,CAENiD,MAFM,CAEGjD,CAAK,CAAG+D,CAAO,CAAC7C,MAFnB,CAAhB,CAGA2D,CAAS,CAACzB,MAAV,CAAmBC,CAAa,CAACR,CAAI,CAACO,MAAN,CAAcyB,CAAS,CAAC5B,MAAV,CAAmBc,CAAO,CAAC/D,CAAD,CAAP,CAAeqE,GAAlC,CAAwC,IAAtD,CAA4DrB,CAA5D,CAAhC,CACA6B,CAAS,CAACC,UAAV,CAAuBzB,CAAa,CAACR,CAAI,CAACO,MAAN,CAAcyB,CAAS,CAAC5B,MAAV,CAAmBc,CAAO,CAAC/D,CAAD,CAAP,CAAewE,IAAlC,CAAyC,IAAvD,CAA6DxB,CAA7D,CAApC,CACAM,CAAS,CAACC,gBAAV,CAA2B,kCAA3B,CAA+DsB,CAA/D,EACK/C,IADL,CACU,WAAgB,IAAd0B,CAAAA,CAAc,GAAdA,IAAc,CAARC,CAAQ,GAARA,EAAQ,CAClBH,CAAS,CAACI,kBAAV,CAA6B,aAA7B,CAA4CF,CAA5C,CAAkDC,CAAlD,EACA,QACH,CAJL,EAKKE,KALL,CAKWC,UAAaC,SALxB,CAMH,CAZD,EAcA9B,CAAK,CAAC+B,IAAN,EACH,CAtBM,CAAD,CAAV,EAwBA,QACH,CA3DD,CA6DH,CAED,GAAe,QAAX,GAAArD,CAAJ,CAAyB,CACrBsD,CAAO,CAAChD,MAAR,CAAef,CAAf,CAAsB,CAAtB,EACA,IAAK,GAAIgB,CAAAA,CAAC,CAAGhB,CAAb,CAAoBgB,CAAC,CAAGlB,CAAS,CAACmB,QAAV,CAAmBC,MAA3C,CAAmDF,CAAC,EAApD,CAAwD,CACpDlB,CAAS,CAACmB,QAAV,CAAmBD,CAAnB,EAAsBd,OAAtB,CAA8BF,KAA9B,CAAsCF,CAAS,CAACmB,QAAV,CAAmBD,CAAnB,EAAsBd,OAAtB,CAA8BF,KAA9B,CAAsC,CAC/E,CACDJ,CAAG,CAACuB,MAAJ,GACAhB,CAAK,CAACK,KAAN,CAAcF,IAAI,CAACO,SAAL,CAAekD,CAAf,CACjB,CACJ,C,CAEK7B,CAAU,CAAG,SAAC6C,CAAD,CAAO,CACtB,GAAuB,MAAnB,GAAAA,CAAC,CAACtF,MAAF,CAASe,KAAb,CAA+B,CAC3B,GAAIwE,CAAAA,CAAK,CAAGhG,QAAQ,CAACiG,aAAT,CAAuB,OAAvB,CAAZ,CACAD,CAAK,CAACE,YAAN,CAAmB,IAAnB,CAAyBH,CAAC,CAACtF,MAAF,CAAS0F,YAAT,CAAsB,IAAtB,CAAzB,EACAJ,CAAC,CAACtF,MAAF,CAASP,aAAT,CAAuB0B,YAAvB,CAAoCoE,CAApC,CAA2CD,CAAC,CAACtF,MAA7C,EACAsF,CAAC,CAACtF,MAAF,CAAS0B,MAAT,EACH,CACJ,C,CAEKkB,CAAU,CAAG,SAAC0C,CAAD,CAAO,IAClB1E,CAAAA,CAAO,CAAG0E,CAAC,CAAClC,IAAF,CAAOxC,OADC,CAElBT,CAAG,CAAGmF,CAAC,CAAClC,IAAF,CAAOjD,GAFK,CAGlBI,CAAK,CAAG+E,CAAC,CAAClC,IAAF,CAAO7C,KAHG,CAIlBG,CAAK,CAAG4E,CAAC,CAAClC,IAAF,CAAO1C,KAJG,CAMtB,GAA8B,WAA1B,QAAOE,CAAAA,CAAO,CAACL,CAAD,CAAlB,CAA2C,CACvCK,CAAO,CAACL,CAAD,CAAP,CAAiB,EAAjB,CACA,GAAIiE,CAAAA,CAAM,CAAGrE,CAAG,CAACV,aAAJ,CAAkBgF,WAAlB,CAA8BtE,CAAG,CAACuE,SAAJ,IAA9B,CAAb,CACAF,CAAM,CAAC/D,OAAP,CAAeF,KAAf,CAAuBA,CAAK,CAAG,CAA/B,CACAJ,CAAG,CAACX,aAAJ,CAAkB,mBAAlB,EAAuCmF,SAAvC,ufASH,CACD,GAAIgB,CAAAA,CAAU,CAAG,CACb,CAAC,IAAO,UAAR,CAAoB,UAAa,uBAAjC,CADa,CAEb,CAAC,IAAO,QAAR,CAAkB,UAAa,uBAA/B,CAFa,CAAjB,CAMA/E,CAAO,CAACL,CAAD,CAAP,CAAeoB,KAAf,CAAuBiE,CAAkB,CAACrG,QAAQ,CAACsF,cAAT,CAAwB,UAAxB,EAAoC9D,KAArC,CAAzC,CACAH,CAAO,CAACL,CAAD,CAAP,CAAemD,QAAf,CAA0BnE,QAAQ,CAACsF,cAAT,CAAwB,aAAxB,EAAuC9D,KAAjE,CACAH,CAAO,CAACL,CAAD,CAAP,CAAesF,QAAf,CAA0BtG,QAAQ,CAACsF,cAAT,CAAwB,aAAxB,EAAuCiB,OAAjE,CAEA,GAAoC,QAAhC,KAAOlF,CAAO,CAACL,CAAD,CAAP,CAAeoB,KAAtB,CAAJ,CAA8C,CAC1CgE,CAAU,CAACpB,IAAX,CAAgB,CACZ,IAAO3D,CAAO,CAACL,CAAD,CAAP,CAAeoB,KAAf,CAAqBoE,UADhB,CAEZ,UAAanF,CAAO,CAACL,CAAD,CAAP,CAAeoB,KAAf,CAAqBqE,SAFtB,CAAhB,CAIH,CAED,GAAI1C,CAAAA,CAAc,CAAG1B,CAAG,CAACqE,WAAJ,CAAgBN,CAAhB,CAArB,CACArC,CAAc,CAACH,IAAf,CAAoB,SAAS+C,CAAT,CAAkB,CAClC/F,CAAG,CAACX,aAAJ,CAAkB,oBAAlB,EAAwCmF,SAAxC,CAAoF,QAAhC,KAAO/D,CAAO,CAACL,CAAD,CAAP,CAAeoB,KAAtB,EAC9CuE,CAAO,CAAC,CAAD,CADuC,CAE9CtF,CAAO,CAACL,CAAD,CAAP,CAAeoB,KAFrB,CAGAxB,CAAG,CAACX,aAAJ,CAAkB,qBAAlB,EAAyCmF,SAAzC,CAAqD/D,CAAO,CAACL,CAAD,CAAP,CAAemD,QAApE,CACAvD,CAAG,CAACX,aAAJ,CAAkB,qBAAlB,EAAyCmF,SAAzC,CAAqD/D,CAAO,CAACL,CAAD,CAAP,CAAesF,QAAf,CAC/CK,CAAO,CAAC,CAAD,CADwC,CAE/CA,CAAO,CAAC,CAAD,CAChB,CARD,EASAxF,CAAK,CAACK,KAAN,CAAcF,IAAI,CAACO,SAAL,CAAeR,CAAf,CACjB,C,CAEKgF,CAAkB,CAAG,SAACO,CAAD,CAAgB,CACvC,GAAI,CACA,GAAIC,CAAAA,CAAC,CAAGvF,IAAI,CAACC,KAAL,CAAWqF,CAAX,CAAR,CACA,GAAIC,CAAC,EAAiB,QAAb,KAAOA,CAAP,CAAT,CAAgC,CAC5B,MAAOA,CAAAA,CACV,CACJ,CAAC,MAAOd,CAAP,CAAU,CAEX,CAED,MAAOa,CAAAA,CACV,C,CAEKvC,CAAa,CAAG,SAACR,CAAD,CAAOM,CAAP,CAAiBH,CAAjB,CAA4B,IAE1C8C,CAAAA,CAAU,CAAGxF,IAAI,CAACO,SAAL,CAAegC,CAAf,CAF6B,CAG1CkD,CAAY,CAAGzF,IAAI,CAACC,KAAL,CAAWuF,CAAX,CAH2B,CAI1CE,CAAC,CAAGD,CAAY,CAAC/B,IAAb,CAAkB,CAAC,SAAY,MAAb,CAAlB,CAJsC,CAK9C,GAAuB,QAAnB,QAAOb,CAAAA,CAAX,CAAiC,CAC7B,GAAInC,CAAAA,CAAJ,CACA,IAAKA,CAAC,CAAG,CAAT,CAAYA,CAAC,CAAGgF,CAAhB,CAAmBhF,CAAC,EAApB,CAAwB,CACpB,GAAI+E,CAAY,CAAC/E,CAAD,CAAZ,CAAgBmC,QAAhB,GAA6BA,CAAjC,CAA2C,CACvC4C,CAAY,CAAC/E,CAAD,CAAZ,CAAgBiF,QAAhB,IACA,KACH,CACJ,CACD,GAAIjF,CAAC,GAAKgF,CAAV,CAAa,CACTD,CAAY,CAAC/B,IAAb,CAAkB,CAAC,SAAYb,CAAb,CAAuB,WAAvB,CAAlB,CACH,CACJ,CAGD4C,CAAY,CAACC,CAAC,CAAG,CAAL,CAAZ,CAAoB7C,QAApB,CAA+BH,CAA/B,CACA+C,CAAY,CAACC,CAAC,CAAG,CAAL,CAAZ,CAAoBxF,KAApB,CAA4B,MAA5B,CACA,MAAOuF,CAAAA,CACV,C,CAEKzG,CAAU,CAAG,SAACC,CAAD,CAAS,CACxBA,CAAG,CAACI,cAAJ,GACA,MAAO4B,CAAAA,CAAY,CAACC,MAAb,CAAoB,CACvBC,IAAI,CAAEF,CAAY,CAACG,KAAb,CAAmBwE,OADF,CAEvBtE,IAAI,CAAE,EAFiB,CAGvBR,KAAK,CAAEC,CAAG,CAACC,UAAJ,CAAe,YAAf,CAA6B,uBAA7B,CAHgB,CAIvBO,aAAa,GAJU,CAApB,EAKJC,IALI,CAKC,SAASC,CAAT,CAAgB,CACpBA,CAAK,CAACC,OAAN,GAAgBC,EAAhB,CAAmB,QAAnB,CAA6BkE,CAA7B,EACA3D,CAAI,CAACC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,sCADL,CAEPC,IAAI,CAAE,CACF,eADE,CAFC,CAKPC,IAAI,CAAE,cAASC,CAAT,CAAe,CACjBS,CAAS,CAACC,gBAAV,CAA2B,8BAA3B,CAA2DV,CAA3D,EACKf,IADL,CACU,WAAgB,IAAd0B,CAAAA,CAAc,GAAdA,IAAc,CAARC,CAAQ,GAARA,EAAQ,CAClBH,CAAS,CAACI,kBAAV,CAA6B,aAA7B,CAA4CF,CAA5C,CAAkDC,CAAlD,EACA,GAAI2C,CAAAA,CAAO,CAAGrE,CAAK,CAACC,OAAN,GAAgB,CAAhB,EAAmB/C,aAAnB,CAAiC,SAAjC,CAAd,CACA,GAAIoH,SAAS,CAACC,SAAd,CAAyB,CACrBF,CAAO,CAACjH,gBAAR,CAAyB,OAAzB,CAAkC,SAAU4F,CAAV,CAAa,CAC3C,GAAIwB,CAAAA,CAAQ,CAAGxB,CAAC,CAACtF,MAAF,CAAS+G,sBAAxB,CACAD,CAAQ,CAACE,MAAT,GACAF,CAAQ,CAACG,iBAAT,CAA2B,CAA3B,CAA8B,KAA9B,EACAL,SAAS,CAACC,SAAV,CAAoBK,SAApB,CAA8BJ,CAAQ,CAAC/F,KAAvC,CACH,CALD,CAMH,CAPD,IAOO,CACH4F,CAAO,CAAClB,YAAR,CAAqB,OAArB,CAA8B,cAA9B,CACH,CACD,QACH,CAfL,EAgBKvB,KAhBL,CAgBWC,UAAaC,SAhBxB,CAiBH,CAvBM,CAAD,CAAV,EAwBA9B,CAAK,CAAC+B,IAAN,GACA,QACH,CAjCM,CAkCV,C,CAEKqC,CAAU,CAAG,SAAC5G,CAAD,CAAS,IACpBO,CAAAA,CAAS,CAAGP,CAAG,CAACE,MAAJ,CAAWI,OAAX,CAAmB,aAAnB,CADQ,CAEpB+G,CAAK,CAAG9G,CAAS,CAACb,aAAV,CAAwB,YAAxB,EAAsCuB,KAF1B,CAGpBqG,CAAY,CAAG/G,CAAS,CAACb,aAAV,CAAwB,cAAxB,CAHK,CAIpB6H,CAAS,CAAGhH,CAAS,CAACb,aAAV,CAAwB,gBAAxB,EAA0CuB,KAJlC,CAMxB,GAAsC,cAAlC,GAAAjB,CAAG,CAACE,MAAJ,CAAW0F,YAAX,CAAwB,IAAxB,CAAJ,CAAsD,CAClD0B,CAAY,CAACrG,KAAb,CAAqBqG,CAAY,CAACrG,KAAb,CAAqB,IAArB,CAA4BjB,CAAG,CAACE,MAAJ,CAAWe,KAAvC,CAA+C,IACvE,CAED,GAAsC,EAAlC,GAAAjB,CAAG,CAACE,MAAJ,CAAW0F,YAAX,CAAwB,IAAxB,CAAJ,CAA0C,CACtC,QACH,CAFD,IAEO,CACHrF,CAAS,CAACb,aAAV,CAAwB,SAAxB,EAAmCuB,KAAnC,CACI,MAAQoG,CAAR,CAAgB,IAAhB,CAAuBC,CAAY,CAACrG,KAApC,CAA4C,WAA5C,CAA0DsG,CAA1D,CAAsE,cAAtE,CAAuFF,CAAvF,CAA+F,IACtG,CAED,QACH,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @file       UI scripts for Grade Calculation Setup Tool.\n * @copyright  Te WÄnanga o Aotearoa\n * @author     Jeremy FitzPatrick\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as ModalFactory from \"core/modal_factory\";\nimport * as ModalEvents from \"core/modal_events\";\nimport * as Str from \"core/str\";\nimport * as Templates from \"core/templates\";\nimport Notification from \"core/notification\";\nimport * as Ajax from \"core/ajax\";\n\nexport const init = () => {\n    document.querySelector(\".rule-fields\").parentElement.addEventListener(\"click\", editrule);\n    document.querySelector(\".rule-cols\").parentElement.addEventListener(\"click\", editrule);\n    document.querySelector(\".rule-actions\").parentElement.addEventListener(\"click\", editaction);\n    document.querySelector('.loophelper').addEventListener('click', loopHelper);\n};\n\n/**\n * Decide which edit button was pressed\n * @param {Event} evt\n */\nconst editrule = (evt) => {\n    let el = evt.target;\n\n    if (el.nodeName !== \"I\") {\n        return;\n    }\n    evt.preventDefault();\n\n    let row = el.closest(\"div\");\n    let container = row.parentNode;\n    let index = parseInt(row.dataset.index);\n    var field = document.querySelector(\"input[name=\" + row.dataset.targetele + \"]\");\n    let columns = JSON.parse(field.value);\n    let action = el.dataset.action;\n\n    if (action === \"up\") {\n        let oldfield = columns[index - 1];\n        columns[index - 1] = columns[index];\n        columns[index] = oldfield;\n\n        row.dataset.index = index - 1;\n        row.previousSibling.dataset.index = index;\n        container.insertBefore(row, row.previousSibling);\n\n        field.value = JSON.stringify(columns);\n        return;\n    }\n\n    if (action === \"down\") {\n        let oldfield = columns[index + 1];\n        columns[index + 1] = columns[index];\n        columns[index] = oldfield;\n\n        row.dataset.index = index + 1;\n        row.nextSibling.dataset.index = index;\n        container.insertBefore(row.nextSibling, row);\n\n        field.value = JSON.stringify(columns);\n        return;\n    }\n\n    if (action === \"delete\") {\n        columns.splice(index, 1);\n        for (let i = index; i < container.children.length; i++) {\n            container.children[i].dataset.index = container.children[i].dataset.index - 1;\n        }\n        row.remove();\n        field.value = JSON.stringify(columns);\n        return;\n    }\n\n    if (action === \"edit\") {\n        let title = row.dataset.targetele === 'fields'\n                   ? Str.get_string(\"editfield\", \"gradereport_calcsetup\")\n                   : Str.get_string(\"editcols\", \"gradereport_calcsetup\");\n\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            body: \"\",\n            title: title,\n            removeOnClose: true\n        }).then(function(modal) {\n            modal.getRoot().on('change', swapSelect);\n            modal.getRoot().on(ModalEvents.save, {columns: columns, row: row, index: index, field: field}, saveFields);\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n            });\n            Ajax.call([{\n                methodname: \"gradereport_calcsetup_get_corefields\",\n                args: {\n                    'editableonly': false\n                },\n                done: function(data) {\n                    data.col = columns[index];\n                    let stringsPromise = Str.get_string(\"free\", \"gradereport_calcsetup\");\n                    stringsPromise.done(function(string) {\n                        data.exists = index < columns.length;\n                        let prop = data.exists ? data.col.property : null;\n                        data.fields = getCorefields(data.fields, prop, string);\n                        if (typeof data.col !== 'undefined') {\n                            data.title = typeof columns[index].title === \"object\"\n                                ? JSON.stringify(columns[index].title)\n                                : columns[index].title;\n                        }\n                        Templates.renderForPromise(\"gradereport_calcsetup/editfield\", data)\n                            .then(({html, js}) => {\n                                Templates.appendNodeContents(\".modal-body\", html, js);\n                                return true;\n                            })\n                            .catch(Notification.exception);\n                    });\n                    modal.show();\n                }\n            }]);\n\n            return true;\n        });\n    }\n};\n\nconst editaction = (evt) => {\n    let el = evt.target;\n\n    if (el.nodeName !== \"I\") {\n        return;\n    }\n    evt.preventDefault();\n\n    let row = el.closest(\"div\");\n    let container = row.parentNode;\n    let index = parseInt(row.dataset.index);\n    var field = document.querySelector(\"input[name=actions]\");\n    let actions = JSON.parse(field.value);\n    let action = el.dataset.action;\n\n    if (action === 'edit') {\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            body: \"\",\n            title: Str.get_string(\"editaction\", \"gradereport_calcsetup\"),\n            removeOnClose: true\n        }).then(function(modal) {\n            modal.getRoot().on('change', swapSelect);\n            modal.getRoot().on(ModalEvents.save, function() {\n                if (index === actions.length) {\n                    actions.push({'op': 'equals'});\n                    let addrow = row.parentElement.appendChild(row.cloneNode(true));\n                    addrow.dataset.index = index + 1;\n                    row.querySelector('span:last-of-type').innerHTML = '<a href=\"#\">' +\n                        '<i class=\"icon fa fa-trash fa-fw\" title=\"Delete\" aria-label=\"Delete\" data-action=\"delete\"></i></a>' +\n                        '<a href=\"#\" ><i class=\"icon fa fa-cog fa-fw\" title=\"Edit\" aria-label=\"Edit\" data-action=\"edit\"></i></a>';\n                }\n\n                actions[index].set = document.getElementById(\"actionset\").value;\n                actions[index].to = document.getElementById(\"actionto\").value;\n                actions[index].when = document.getElementById(\"actionwhen\").value;\n                actions[index].val = document.getElementById(\"actionval\").value;\n                field.value = JSON.stringify(actions);\n\n                // First get operator string\n                let operator = Str.get_string(actions[index].op, 'gradereport_calcsetup', actions[index]);\n                operator.done(function(string) {\n                    actions[index].op = string;\n                    let description = Str.get_string('action', 'gradereport_calcsetup', actions[index]);\n                    description.done(function(string) {\n                        row.querySelector('span:first-of-type').innerHTML = string;\n                    });\n                });\n\n            });\n            Ajax.call([{\n                methodname: \"gradereport_calcsetup_get_corefields\",\n                args: {\n                    'editableonly': true\n                },\n                done: function(data) {\n                    let stringsPromise = Str.get_string(\"free\", \"gradereport_calcsetup\");\n                    stringsPromise.done(function(string) {\n                        let actionrow = {};\n                        actionrow.action = index < actions.length ? actions[index] : [];\n                        actionrow.exists = index < actions.length;\n                        actionrow.fields = getCorefields(data.fields, actionrow.exists ? actions[index].set : null, string);\n                        actionrow.fieldswhen = getCorefields(data.fields, actionrow.exists ? actions[index].when : null, string);\n                        Templates.renderForPromise(\"gradereport_calcsetup/editaction\", actionrow)\n                            .then(({html, js}) => {\n                                Templates.appendNodeContents(\".modal-body\", html, js);\n                                return true;\n                            })\n                            .catch(Notification.exception);\n                    });\n\n                    modal.show();\n                }\n            }]);\n            return true;\n        });\n\n    }\n\n    if (action === 'delete') {\n        actions.splice(index, 1);\n        for (var i = index; i < container.children.length; i++) {\n            container.children[i].dataset.index = container.children[i].dataset.index - 1;\n        }\n        row.remove();\n        field.value = JSON.stringify(actions);\n    }\n};\n\nconst swapSelect = (e) => {\n    if (e.target.value === \"free\") {\n        let input = document.createElement(\"input\");\n        input.setAttribute(\"id\", e.target.getAttribute(\"id\"));\n        e.target.parentElement.insertBefore(input, e.target);\n        e.target.remove();\n    }\n};\n\nconst saveFields = (e) => {\n    let columns = e.data.columns;\n    let row = e.data.row;\n    let index = e.data.index;\n    let field = e.data.field;\n\n    if (typeof columns[index] === 'undefined') {\n        columns[index] = {};\n        let addrow = row.parentElement.appendChild(row.cloneNode(true));\n        addrow.dataset.index = index + 1;\n        row.querySelector(\"span:last-of-type\").innerHTML =\n            \"<a class='up' href='#'>\" +\n            \"<i class='icon fa fa-arrow-up fa-fw ' title='$strup' aria-label='$strup' data-action='up'></i>\" +\n            \"</a><a class='down' href='#'>\" +\n            \"<i class='icon fa fa-arrow-down fa-fw ' title='$strdn' aria-label='$strdn' data-action='down'></i>\" +\n            \"</a><a class='delete' href='#'>\" +\n            \"<i class='icon fa fa-trash fa-fw ' title='$strdel' aria-label='$strdel' data-action='delete'></i>\" +\n            \"</a><a class='edit' href='#'>\" +\n            \"<i class='icon fa fa-cog fa-fw ' title='$stredit' aria-label='$stredit' data-action='edit'></i></a>\";\n    }\n    let reqStrings = [\n        {\"key\": \"editable\", \"component\": \"gradereport_calcsetup\"},\n        {\"key\": \"locked\", \"component\": \"gradereport_calcsetup\"}\n    ];\n\n    // Set the data.\n    columns[index].title = tryParseJSONObject(document.getElementById(\"coltitle\").value);\n    columns[index].property = document.getElementById(\"colproperty\").value;\n    columns[index].editable = document.getElementById(\"coleditable\").checked;\n    // Set the dom.\n    if (typeof columns[index].title === \"object\") {\n        reqStrings.push({\n            \"key\": columns[index].title.identifier,\n            \"component\": columns[index].title.component\n        });\n    }\n\n    let stringsPromise = Str.get_strings(reqStrings);\n    stringsPromise.done(function(strings) {\n        row.querySelector(\"span:first-of-type\").innerHTML = typeof columns[index].title === \"object\"\n            ? strings[2]\n            : columns[index].title;\n        row.querySelector(\"span:nth-of-type(2)\").innerHTML = columns[index].property;\n        row.querySelector(\"span:nth-of-type(3)\").innerHTML = columns[index].editable\n            ? strings[0]\n            : strings[1];\n    });\n    field.value = JSON.stringify(columns);\n};\n\nconst tryParseJSONObject = (jsonString) => {\n    try {\n        var o = JSON.parse(jsonString);\n        if (o && typeof o === \"object\") {\n            return o;\n        }\n    } catch (e) {\n        // Do nothing.\n    }\n\n    return jsonString;\n};\n\nconst getCorefields = (data, property, string) => {\n    // We need a deep clone.\n    let dataString = JSON.stringify(data);\n    let giProperties = JSON.parse(dataString);\n    let l = giProperties.push({\"property\": \"free\"});\n    if (typeof property == 'string') {\n        var i;\n        for (i = 0; i < l; i++) {\n            if (giProperties[i].property === property) {\n                giProperties[i].selected = true;\n                break;\n            }\n        }\n        if (i === l) {\n            giProperties.push({\"property\": property, \"selected\": true});\n        }\n    }\n\n    // Replace the last item \"free\" with a readable name.\n    giProperties[l - 1].property = string;\n    giProperties[l - 1].value = \"free\";\n    return giProperties;\n};\n\nconst loopHelper = (evt) => {\n    evt.preventDefault();\n    return ModalFactory.create({\n        type: ModalFactory.types.DEFAULT,\n        body: \"\",\n        title: Str.get_string('loophelper', 'gradereport_calcsetup'),\n        removeOnClose: false\n    }).then(function(modal) {\n        modal.getRoot().on('change', updateCalc);\n        Ajax.call([{\n            methodname: \"gradereport_calcsetup_get_corefields\",\n            args: {\n                'editableonly': false\n            },\n            done: function(data) {\n                Templates.renderForPromise(\"gradereport_calcsetup/looper\", data)\n                    .then(({html, js}) => {\n                        Templates.appendNodeContents(\".modal-body\", html, js);\n                        let copyBtn = modal.getRoot()[0].querySelector('.copyme');\n                        if (navigator.clipboard) {\n                            copyBtn.addEventListener('click', function (e) {\n                                let copyText = e.target.previousElementSibling;\n                                copyText.select();\n                                copyText.setSelectionRange(0, 99999);\n                                navigator.clipboard.writeText(copyText.value);\n                            });\n                        } else {\n                            copyBtn.setAttribute(\"style\", \"display:none\");\n                        }\n                        return true;\n                    })\n                    .catch(Notification.exception);\n            }}]);\n        modal.show();\n        return true;\n    });\n};\n\nconst updateCalc = (evt) => {\n    let container = evt.target.closest('.modal-body');\n    let group = container.querySelector('#loopgroup').value;\n    let contentInput = container.querySelector('#loopcontent');\n    let separator = container.querySelector('#loopseparator').value;\n\n    if (evt.target.getAttribute('id') === 'loopproperty') {\n        contentInput.value = contentInput.value + \"{{\" + evt.target.value + \"}}\";\n    }\n\n    if (evt.target.getAttribute('id') === '') {\n        return true;\n    } else {\n        container.querySelector('.output').value =\n            \"{{#\" + group + \"}}\" + contentInput.value + \"{{^last}}\" + separator + \"{{/last}}{{/\" + group + \"}}\";\n    }\n\n    return true;\n};"],"file":"editrule.min.js"}